#ddev-generated
# If you remove the ddev-generated line above you
# are responsible for maintaining this file. DDEV will not then
# update it, for example if you add 'additional_hostnames', etc.
# However, it is now unnecessary and imprudent to take control of
# this file, as there is now a dynamic merge mechanism. To use it,
# create <project>/.ddev/traefik/dynamic_config.*.yaml files which
# will then be merged in alphanumeric order. See the readme in the
# /traefik directory for more information

{{- $appName := .App.Name | toLower }}
http:
    middlewares:
        redirectHttps-{{ .App.Name }}:
            redirectScheme:
                permanent: true
                scheme: https
    routers:
        {{ .App.Name }}-web-80-http:
            entrypoints:
                - http-80
            middlewares: []
            rule: HostRegexp(`^{{ $appName }}\.ddev\.site$`)
            ruleSyntax: v3
            service: {{ .App.Name }}-web-80
            tls: false
        {{ .App.Name }}-web-80-https:
            entrypoints:
                - http-443
            middlewares: []
            rule: HostRegexp(`^{{ $appName }}\.ddev\.site$`)
            ruleSyntax: v3
            service: {{ .App.Name }}-web-80
            tls: true
        {{ .App.Name }}-web-8025-http:
            entrypoints:
                - http-8025
            middlewares: []
            rule: HostRegexp(`^{{ $appName }}\.ddev\.site$`)
            ruleSyntax: v3
            service: {{ .App.Name }}-web-8025
            tls: false
        {{ .App.Name }}-web-8025-https:
            entrypoints:
                - http-8026
            middlewares: []
            rule: HostRegexp(`^{{ $appName }}\.ddev\.site$`)
            ruleSyntax: v3
            service: {{ .App.Name }}-web-8025
            tls: true
    services:
        {{ .App.Name }}-web-80:
            loadbalancer:
                servers:
                    - url: http://ddev-{{ .App.Name }}-web:80
        {{ .App.Name }}-web-8025:
            loadbalancer:
                servers:
                    - url: http://ddev-{{ .App.Name }}-web:8025
tls:
    certificates:
        - certFile: /mnt/ddev-global-cache/traefik/certs/{{ .App.Name }}.crt
          keyFile: /mnt/ddev-global-cache/traefik/certs/{{ .App.Name }}.key
