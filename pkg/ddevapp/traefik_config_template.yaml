#ddev-generated

http:
  routers:
    {{$appname := .App.Name}}{{$hostnames := .Hostnames}}{{ range $s := .RoutingTable }}
    {{ if not $s.HTTPS }}
    {{$appname}}-{{$s.InternalServiceName}}-{{$s.InternalServicePort}}-http:
      rule: "Host({{ range $i, $h := $hostnames }}{{if $i}}, {{end}}`{{$h}}`{{end}})"
      service: "{{$appname}}-{{$s.InternalServiceName}}-{{$s.InternalServicePort}}-http"
      tls: false
      entrypoints:
        - http-{{$s.ExternalPort}}
    {{ end }}{{ end }}
    {{$appname := .App.Name}}{{$hostnames := .Hostnames}}{{ range $s := .RoutingTable }}{{ if $s.HTTPS }}
    {{$appname}}-{{$s.InternalServiceName}}-{{$s.InternalServicePort}}-https:
      rule: "Host({{ range $i, $h := $hostnames }}{{if $i}}, {{end}}`{{$h}}`{{end}})"
      service: "{{$appname}}-{{$s.InternalServiceName}}-{{$s.InternalServicePort}}-https"
      tls: true
      entrypoints:
        - http-{{$s.ExternalPort}}
    {{ end }}
    {{ end }}

#    {{.App.Name}}-https:
#      rule: "Host({{ range $i, $h := .Hostnames }}{{if $i}}, {{end}}`{{$h}}`{{end}})"
#      service: "ddev-{{.App.Name}}-web-https"
#      tls: true
#      entrypoints:
#        - web-secure

  services:
    {{$appname := .App.Name}}{{ range $s := .RoutingTable }}{{ if $s.HTTPS }}
    {{$appname}}-{{ $s.InternalServiceName }}-{{ $s.InternalServicePort }}-https:
    {{ else }}
    {{$appname}}-{{ $s.InternalServiceName }}-{{ $s.InternalServicePort }}-http:{{end}}
      loadbalancer:
        servers:
          - url: http://ddev-{{$appname}}-{{$s.InternalServiceName}}:{{$s.InternalServicePort}}
    {{ end }}
#    ddev-{{.App.Name}}-web-https:
#      loadbalancer:
#        servers:
#          - url: http://ddev-{{.App.Name}}-web

tls:
  certificates:
    - certFile: {{ .TargetCertsPath }}/{{ .App.Name }}.crt
      keyFile: {{ .TargetCertsPath }}/{{ .App.Name }}.key
