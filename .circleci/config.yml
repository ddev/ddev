version: 2
stages:
  build:
    macos:
      xcode: "9.0"

    environment:
      ARTIFACTS: /artifacts

    working_directory: ~/ddev

    steps:
      - checkout

      - run: brew cask install docker
      - run: brew install docker docker-compose
      - run: sudo /Applications/Docker.app/Contents/MacOS/Docker --unattended &
      - run: sleep 60
      - run: sudo chmod 777 /var/root/library /var/root/Library/Containers
      - run: sudo chown distiller /var/run/docker.sock
      - run: docker run busybox ls
