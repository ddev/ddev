#!/bin/bash

## #ddev-generated: If you want to edit and own this file, remove this line.
## Description: Launch a browser with the current site
## Usage: launch [path] [-p|--phpmyadmin] [-m|--mailhog]
## Flags: [{"Long":"phpmyadmin","Short":"p","Usage":"Launch phpMyAdmin"},{"Long":"mailhog","Short":"m","Usage":"Launch MailHog"}]
## Example: ddev launch\nddev launch /admin/reports/status/php\nddev launch phpinfo.php\nddev launch -p\nddev launch

FULLURL=${DDEV_PRIMARY_URL}
HTTPS=""
if [ ${DDEV_PRIMARY_URL%://*} = "https" ]; then HTTPS=true; fi

while :; do
    case ${1:-} in
        -p|--phpmyadmin)
            if [ "${HTTPS}" = "" ]; then
                FULLURL="${FULLURL%:[0-9]*}:${DDEV_PHPMYADMIN_PORT}"
            else
                FULLURL="${FULLURL%:[0-9]*}:${DDEV_PHPMYADMIN_HTTPS_PORT}"
            fi
            ;;
        -m|--mailhog)
            if [ "${HTTPS}" = "" ]; then
                FULLURL="${FULLURL%:[0-9]*}:${DDEV_MAILHOG_PORT}"
            else
                FULLURL="${FULLURL%:[0-9]*}:${DDEV_MAILHOG_HTTPS_PORT}"
            fi
            ;;
        --)     # End of all options.
            shift
            break
            ;;
        -?*)
            printf 'WARN: Unknown option (ignored): %s\n' "$1" >&2
            ;;
        *)      # Default case: No more options, so break out of the loop.
            break
    esac

    shift
 done

if [ -n "${1:-}" ] ; then
    if [[ ${1::1} != "/" ]] ; then
        FULLURL="${FULLURL}/";
    fi

    FULLURL="${FULLURL}${1}";
fi

if [ ! -z ${DDEV_DEBUG:-} ]; then
    printf "FULLURL $FULLURL\n" && exit 0
fi

case $OSTYPE in
    linux-gnu)
        xdg-open ${FULLURL}
        ;;
    "darwin"*)
        open ${FULLURL}
        ;;
    "win*"* | "msys"*)
        start ${FULLURL}
        ;;
esac
