#ddev-generated
# Example Platform.sh provider configuration.

# To use this configuration,
# 1. Create a platform.sh token (Account->API Tokens).
# 2. Add add an entry to web_environment in ~/.ddev/global_config.yaml with the token:
# web_environment:
# - PLATFORMSH_CLI_TOKEN=xxxxxxxx
# 3. Copy platform.yaml.example to platform.yaml.
# 4. Update project_id and environment below.
# 5. `ddev restart`
# 5. Use `ddev pull platform` to pull the project database and files.

# Debugging: Use `ddev exec platform` to see what platform.sh knows about
# your configuration and whether it's working correctly.

environment_variables:
  project_id: lago3j23xu2w6
  environment: master

auth_command:
  command: |
    if [ -z "${PLATFORMSH_CLI_TOKEN:-}" ]; then echo "Please make sure you have set PLATFORMSH_CLI_TOKEN in ~/.ddev/global_config.yaml" && exit 1; fi
    # ssh-add -l >/dev/null || ( echo "Please 'ddev auth ssh' before running this command." && exit 1 )

db_pull_command:
  command: |
    ls /var/www/html/.ddev >/dev/null # This just refreshes stale NFS if possible
    platform db:dump --yes --gzip --file=/var/www/html/.ddev/.downloads/db.sql.gz --project="${project_id}" --environment="${environment}"

files_pull_command:
  command: |
    ls /var/www/html/.ddev >/dev/null # This just refreshes stale NFS if possible
    platform mount:download --yes --quiet --project="${project_id}" --environment="${environment}" --mount=web/sites/default/files --target=/var/www/html/.ddev/.downloads/files


# push is a dangerous command. If not absolutely needed it's better to delete these lines.
db_push_command:
  command: |
    ls /var/www/html/.ddev >/dev/null # This just refreshes stale NFS if possible
    pushd /var/www/html/.ddev/.downloads >/dev/null;
    gzip -dc db.sql.gz | platform db:sql --project="${project_id}" --environment="${environment}"

# push is a dangerous command. If not absolutely needed it's better to delete these lines.
files_push_command:
  command: |
    ls "${DDEV_FILES_DIR}" >/dev/null # This just refreshes stale NFS if possible
    platform mount:upload --yes --quiet --project="${project_id}" --environment="${environment}" --source="${DDEV_FILES_DIR}" --mount=web/sites/default/files
